<script>
    import "/src/app.css";
  
    export let title = "InstituÈ›iile Uniunii Europene";
  
    export let sections = [
      {
        content: "Parlamentul European are sediul la Strasbourg È™i este format din membri aleÈ™i prin vot universal de cetÄƒÈ›enii din È›Äƒrile UE. NumÄƒrul de parlamentari ai fiecÄƒrei È›Äƒri este direct proporÈ›ional cu numÄƒrul locuitorilor. \n\nAtribuÈ›ii: VoteazÄƒ legile UE È™i bugetul UE.",
        imageUrl: "https://www.forbes.ro/wp-content/uploads/2022/07/Parlamentul-European.jpg",
        imageAlt: "Parlamentul European, Strasbourg"
      },
      {
        content: "Comisia EuropeanÄƒ are sediul la Bruxelles È™i este alcÄƒtuitÄƒ din cÃ¢te un membru din fiecare È›arÄƒ, numit de guvernul È›Äƒrii respective. \n\nAtribuÈ›ii: Propune proiecte de lege pentru Parlamentul European È™i urmÄƒreÈ™te punerea Ã®n aplicare a legilor È™i programelor UE.",
        imageUrl: "https://cdn.adh.reperio.news/image-b/bc5eb70d-85e8-461c-b802-fa206062eff7/index.jpeg?p=a%3D1%26co%3D1.05%26w%3D700%26h%3D750%26r%3Dcontain%26f%3Dwebp",
        imageAlt: "Comisia EuropeanÄƒ, Bruxelles"
      },
      {
        content: "Consiliul UE are sediul la Bruxelles È™i este format din miniÈ™trii statelor membre, reuniÈ›i Ã®n funcÈ›ie de problema discutatÄƒ (agriculturÄƒ, mediu, educaÈ›ie etc.). \n\nAtribuÈ›ii: AdoptÄƒ regulamente È™i stabileÈ™te proiectul bugetului UE.",
        imageUrl: "https://www.caleaeuropeana.ro/wp-content/uploads/2016/12/15203165_1161374257245561_3383735731290230340_n.jpg",
        imageAlt: "Consiliul UE, Bruxelles"
      },
      {
        content: "Curtea de JustiÈ›ie a UE, cu sediul la Luxemburg, este alcÄƒtuitÄƒ din cÃ¢te un judecÄƒtor numit de fiecare stat membru pentru 6 ani. \n\nAtribuÈ›ii: AsigurÄƒ interpretarea È™i aplicarea corectÄƒ a legilor europene È™i garanteazÄƒ respectarea legislaÈ›iei UE de cÄƒtre statele membre.",
        imageUrl: "https://hotnews.ro/wp-content/uploads/2024/09/profimedia-0771254653.jpg?w=800&h=533&crop=1",
        imageAlt: "Curtea de JustiÈ›ie a UE, Luxemburg"
      },
      {
        content: "Curtea de Conturi, situatÄƒ la Luxemburg, este alcÄƒtuitÄƒ din cÃ¢te un membru din fiecare stat, numit de Consiliul de MiniÈ™tri pentru 6 ani. \n\nAtribuÈ›ii: UrmÄƒreÈ™te utilizarea corectÄƒ a Fondurilor Europene de cÄƒtre statele membre.",
        imageUrl: "https://www.bursa.ro/_img/articole/mare/399308.jpg",
        imageAlt: "Curtea de Conturi, Luxemburg"
      },
      {
        content: "Consiliul European, cu sediul la Bruxelles, este alcÄƒtuit din È™efii sau prim-miniÈ™trii statelor membre È™i se Ã®ntruneÈ™te cel puÈ›in de 2 ori pe an. Fiecare stat deÈ›ine preÈ™edinÈ›ia pentru 6 luni prin rotaÈ›ie. \n\nAtribuÈ›ii: StabileÈ™te politica generalÄƒ a UE, inclusiv aderarea de noi state, adoptarea monedei euro de cÄƒtre noi state È™i extinderea spaÈ›iului Schengen.",
        imageUrl: "https://upload.wikimedia.org/wikipedia/commons/2/2e/Europa_building_February_2016_%28cropped%29.jpg",
        imageAlt: "Consiliul European, Bruxelles"
      },
      {
        content: "Banca CentralÄƒ EuropeanÄƒ are sediul la Frankfurt. \n\nAtribuÈ›ii: Emite moneda euro, asigurÄƒ stabilitatea preÈ›urilor Ã®n zona euro, controleazÄƒ inflaÈ›ia È™i protejeazÄƒ sistemul financiar È™i bancar al statelor membre.",
        imageUrl: "https://upload.wikimedia.org/wikipedia/commons/thumb/9/9e/ECB_Frankfurt_at_Sunset.jpg/220px-ECB_Frankfurt_at_Sunset.jpg",
        imageAlt: "Banca CentralÄƒ EuropeanÄƒ, Frankfurt"
      },
      {
        content: "Ãn prezent, moneda euro este folositÄƒ Ã®n 20 de state.",
        imageUrl: "https://upload.wikimedia.org/wikipedia/commons/thumb/6/65/Euro_coins_and_banknotes.jpg/640px-Euro_coins_and_banknotes.jpg",
        imageAlt: "Simbolul monedei euro"
      }
    ];
  
    let currentGroupIndex = 0;
    const itemsPerPage = 3;
    let direction = 'forward';
    let animateNext = false;
    let animatePrev = false;
    let showQuiz = false;
    let currentQuestionIndex = 0;
    let selectedAnswer = null;
    let score = 0;
  
    // Quiz questions based on the lecture content
    const quizQuestions = [
  {
    question: "Unde are sediul Parlamentul European È™i cum sunt aleÈ™i membrii sÄƒi?",
    options: [
      "Strasbourg, aleÈ™i prin vot universal",
      "Bruxelles, numiÈ›i de guverne",
      "Luxemburg, aleÈ™i de consilii locale",
      "Frankfurt, aleÈ™i prin vot direct"
    ],
    correctAnswer: 0,
    explanation: "Parlamentul European se aflÄƒ la Strasbourg, iar membrii sÄƒi sunt aleÈ™i prin vot universal, proporÈ›ional cu populaÈ›ia fiecÄƒrei È›Äƒri."
  },
  {
    question: "Care este atribuÈ›ia principalÄƒ a Comisiei Europene?",
    options: [
      "VoteazÄƒ legile UE",
      "Propune proiecte de lege È™i monitorizeazÄƒ implementarea acestora",
      "AdoptÄƒ regulamente",
      "InterpreteazÄƒ legile UE"
    ],
    correctAnswer: 1,
    explanation: "Comisia EuropeanÄƒ propune proiecte de lege pentru Parlamentul European È™i se asigurÄƒ cÄƒ legile È™i programele UE sunt implementate corect."
  },
  {
    question: "Ce rol are Consiliul UE Ã®n procesul legislativ?",
    options: [
      "ElaboreazÄƒ bugetul UE",
      "AdoptÄƒ regulamente È™i stabileÈ™te proiectul bugetului UE",
      "VoteazÄƒ legile UE",
      "InterpreteazÄƒ legislaÈ›ia UE"
    ],
    correctAnswer: 1,
    explanation: "Consiliul UE, format din miniÈ™trii statelor membre, adoptÄƒ regulamente È™i stabileÈ™te proiectul bugetului UE, Ã®n funcÈ›ie de temele discutate."
  },
  {
    question: "Ce asigurÄƒ Curtea de JustiÈ›ie a UE?",
    options: [
      "MonitorizeazÄƒ finanÈ›ele UE",
      "AdoptÄƒ bugetul UE",
      "InterpreteazÄƒ È™i aplicÄƒ corect legile europene",
      "Propune proiecte de lege"
    ],
    correctAnswer: 2,
    explanation: "Curtea de JustiÈ›ie a UE interpreteazÄƒ È™i aplicÄƒ corect legile europene, garantÃ¢nd respectarea acestora de cÄƒtre statele membre."
  },
  {
    question: "Ce urmÄƒreÈ™te Curtea de Conturi a UE?",
    options: [
      "Utilizarea corectÄƒ a Fondurilor Europene",
      "Controlul inflaÈ›iei",
      "Adoptarea regulilor bugetare",
      "Monitorizarea legislaÈ›iei UE"
    ],
    correctAnswer: 0,
    explanation: "Curtea de Conturi se asigurÄƒ cÄƒ Fondurile Europene sunt utilizate corect de cÄƒtre statele membre."
  },
  {
    question: "Ce stabileÈ™te Consiliul European?",
    options: [
      "LegislaÈ›ia naÈ›ionalÄƒ a statelor membre",
      "Politica generalÄƒ a UE, inclusiv criteriile de aderare È™i extinderea spaÈ›iului Schengen",
      "Regulamentele interne ale UE",
      "Procedurile de vot Ã®n Parlamentul European"
    ],
    correctAnswer: 1,
    explanation: "Consiliul European, alcÄƒtuit din È™efii sau prim-miniÈ™trii statelor membre, stabileÈ™te politica generalÄƒ a UE, inclusiv aderarea de noi state È™i extinderea spaÈ›iului Schengen."
  },
  {
    question: "Care sunt principalele atribuÈ›ii ale BÄƒncii Centrale Europene?",
    options: [
      "Emite moneda euro È™i asigurÄƒ stabilitatea preÈ›urilor Ã®n zona euro",
      "VoteazÄƒ legile UE",
      "Propune proiecte de lege",
      "InterpreteazÄƒ legile europene"
    ],
    correctAnswer: 0,
    explanation: "Banca CentralÄƒ EuropeanÄƒ emite moneda euro È™i se asigurÄƒ cÄƒ preÈ›urile din zona euro rÄƒmÃ¢n stabile, controlÃ¢nd inflaÈ›ia È™i protejÃ¢nd sistemul financiar."
  },
  {
    question: "Ãn cÃ¢te state este utilizatÄƒ moneda euro Ã®n prezent?",
    options: [
      "20",
      "25",
      "27",
      "30"
    ],
    correctAnswer: 0,
    explanation: "Moneda euro este folositÄƒ Ã®n prezent Ã®n 20 de state membre."
  }
];

  
    function nextGroup() {
      direction = 'forward';
      if ((currentGroupIndex + 1) * itemsPerPage < sections.length) {
        currentGroupIndex++;
      }
    }
  
    function previousGroup() {
      direction = 'backward';
      if (currentGroupIndex > 0) {
        currentGroupIndex--;
      }
    }
  
    function handleNext() {
      animateNext = true;
      nextGroup();
    }
  
    function handlePrev() {
      animatePrev = true;
      previousGroup();
    }
  
    function startQuiz() {
      showQuiz = true;
    }
  
    function handleAnswer(index) {
      if (selectedAnswer !== null) return;
      selectedAnswer = index;
      if (index === quizQuestions[currentQuestionIndex].correctAnswer) score++;
    }
  
    function nextQuestion() {
      if (currentQuestionIndex < quizQuestions.length - 1) {
        currentQuestionIndex++;
        selectedAnswer = null;
      } else {
        currentQuestionIndex++;
      }
    }
  
    $: canGoBack = currentGroupIndex > 0;
    $: canGoNext = (currentGroupIndex + 1) * itemsPerPage < sections.length;
  </script>
  
  <div class="p-5 -mt-20 fade-in">
    {#if !showQuiz}
      <p class="text-4xl font-bold text-white text-outline mb-8 text-center">
        {title}
      </p>
  
      {#key currentGroupIndex}
        <div>
          {#each sections.slice(currentGroupIndex * itemsPerPage, (currentGroupIndex + 1) * itemsPerPage) as section}
            <div class="flex flex-wrap justify-center items-center gap-8 lg:gap-12 mb-10">
              <div class="min-w-[300px] max-w-4xl flex-1">
                <p class="text-2xl text-white text-outline font-bold text-center lg:text-left">
                  {section.content}
                </p>
              </div>
              <img 
                src={section.imageUrl} 
                alt={section.imageAlt} 
                class="h-60 lg:h-80 w-auto rounded-2xl border-4 border-[#125768] shrink-0 transition-all"
                loading="lazy"
              >
            </div>
          {/each}
        </div>
      {/key}
  
      {#if canGoBack}
        <button
          on:click={handlePrev}
          on:animationend={() => animatePrev = false}
          class="fixed left-8 top-1/2 -translate-y-1/2 bg-white/30 rounded-full p-2 hover:bg-white/50 transition-colors arrow-button"
          class:animate-arrow={animatePrev}
          aria-label="SecÈ›iuni precedente"
        >
          <svg xmlns="http://www.w3.org/2000/svg" width="40" height="40" viewBox="0 0 24 24" fill="none" stroke="white" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
            <path d="M19 12H5M12 19l-7-7 7-7"/>
          </svg>
        </button>
      {/if}
  
      {#if canGoNext}
        <button
          on:click={handleNext}
          on:animationend={() => animateNext = false}
          class="fixed right-8 top-1/2 -translate-y-1/2 bg-white/30 rounded-full p-2 hover:bg-white/50 transition-colors arrow-button"
          class:animate-arrow={animateNext}
          aria-label="SecÈ›iuni urmÄƒtoare"
        >
          <svg xmlns="http://www.w3.org/2000/svg" width="40" height="40" viewBox="0 0 24 24" fill="none" stroke="white" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
            <path d="M5 12h14M12 5l7 7-7 7"/>
          </svg>
        </button>
      {/if}
  
      {#if (currentGroupIndex + 1) * itemsPerPage >= sections.length && !showQuiz}
        <button
          on:click={startQuiz}
          class="fixed right-8 top-1/2 -translate-y-1/2 bg-white/30 rounded-full p-2 hover:bg-white/50 transition-colors quiz-arrow-button animate-arrow"
          aria-label="Ãncepe chestionarul"
        >
          <svg xmlns="http://www.w3.org/2000/svg" width="40" height="40" viewBox="0 0 24 24" fill="none" stroke="white" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
            <path d="M5 12h14M12 5l7 7-7 7"/>
          </svg>
        </button>
      {/if}
    {:else}
      <div class="quiz-container max-w-4xl mx-auto p-6">
        {#if currentQuestionIndex < quizQuestions.length}
          <div class="bg-white/30 backdrop-blur-lg rounded-2xl p-8 shadow-xl mb-8">
            <div class="text-white text-outline mb-6">
              <h3 class="text-2xl font-bold text-outline mb-2">Ãntrebarea {currentQuestionIndex + 1}/{quizQuestions.length}</h3>
              <p class="text-xl text-outline leading-relaxed">{quizQuestions[currentQuestionIndex].question}</p>
            </div>
  
            <div class="grid gap-4 mb-8">
              {#each quizQuestions[currentQuestionIndex].options as option, index (index)}
                <button
                  class="option-btn text-outline relative p-4 text-left rounded-xl transition-all"
                  class:correct={selectedAnswer !== null && index === quizQuestions[currentQuestionIndex].correctAnswer}
                  class:incorrect={selectedAnswer === index && index !== quizQuestions[currentQuestionIndex].correctAnswer}
                  on:click={() => handleAnswer(index)}
                  disabled={selectedAnswer !== null}
                >
                  <span class="mr-4 font-bold">{String.fromCharCode(65 + index)}.</span>
                  {option}
                </button>
              {/each}
            </div>
  
            {#if selectedAnswer !== null}
              <div class="pt-6 border-t-2 border-[#125768]/50">
                <div class:correct={selectedAnswer === quizQuestions[currentQuestionIndex].correctAnswer} class:incorrect={selectedAnswer !== quizQuestions[currentQuestionIndex].correctAnswer} class="feedback-message p-4 rounded-lg mb-6">
                  {#if selectedAnswer === quizQuestions[currentQuestionIndex].correctAnswer}
                    âœ“ Corect! 
                  {:else}
                    âœ— Incorect. 
                  {/if}
                  {quizQuestions[currentQuestionIndex].explanation}
                </div>
  
                <button 
                  on:click={nextQuestion}
                  class="next-question-btn w-full py-3 rounded-lg bg-[#125768] hover:bg-[#1a7f94] transition-colors text-white font-bold"
                >
                  {currentQuestionIndex < quizQuestions.length - 1 ? 'UrmÄƒtoarea Ã®ntrebare â”' : 'Vezi rezultatul'}
                </button>
              </div>
            {/if}
          </div>
        {:else}
          <div class="text-center bg-white/30 backdrop-blur-md rounded-2xl p-12 shadow-xl animate-fade-in">
            <h2 class="text-3xl text-white text-outline font-bold mb-6">FelicitÄƒri! ğŸ‰</h2>
            <div class="text-5xl text-white text-outline font-bold mb-8">{score}/{quizQuestions.length}</div>
            <p class="text-xl text-white text-outline mb-8">
              {#if score === quizQuestions.length}
                PerformanÈ›Äƒ remarcabilÄƒ! Ai o cunoaÈ™tere excelentÄƒ a instituÈ›iilor UE!
              {:else if score >= Math.floor(quizQuestions.length * 0.6)}
                Rezultat foarte bun! ContinuÄƒ sÄƒ explorezi tema!
              {:else}
                Bun Ã®nceput! RecomandÄƒm recitirea materialului pentru consolidare.
              {/if}
            </p>
          </div>
        {/if}
      </div>
    {/if}
  </div>
  
  <style>
    .fade-in {
      animation: fadeIn 0.5s ease-in;
    }
    
    @keyframes fadeIn {
      from { opacity: 0; transform: translateY(20px); }
      to { opacity: 1; transform: translateY(0); }
    }
  
    .text-outline {
      text-shadow: 
        -1px -1px 0 #000,  
        1px -1px 0 #000,
        -1px 1px 0 #000,
        1px 1px 0 #000;
    }
  
    .arrow-button, .quiz-arrow-button {
      filter: drop-shadow(0 2px 4px rgba(0, 0, 0, 0.3));
      backdrop-filter: blur(2px);
      transition: transform 0.2s ease-in-out, background-color 0.2s ease;
    }
  
    .arrow-button:hover, .quiz-arrow-button:hover {
      transform: translateY(-50%) scale(1.1);
      background-color: rgba(255, 255, 255, 0.5);
    }
  
    .animate-arrow {
      animation: arrowClickAnim 300ms ease-out;
    }
  
    @keyframes arrowClickAnim {
      0% { transform: scale(1); }
      50% { transform: scale(1.2); }
      100% { transform: scale(1); }
    }
  
    .option-btn {
      background: rgba(255, 255, 255, 0.1);
      border: 2px solid #125768;
      color: white;
      font-size: 1.1rem;
    }
  
    .option-btn:hover:not(:disabled) {
      background: rgba(255, 255, 255, 0.2);
      transform: translateY(-2px);
    }
  
    .option-btn.correct {
      background: rgba(40, 167, 69, 0.3);
      border-color: #28a745;
    }
  
    .option-btn.incorrect {
      background: rgba(220, 53, 69, 0.3);
      border-color: #dc3545;
    }
  
    .feedback-message {
      background: rgba(255, 255, 255, 0.15);
      border-left: 4px solid;
    }
  
    .feedback-message.correct {
      border-color: #005a15;
      color: #009e32;
    }
  
    .feedback-message.incorrect {
      border-color: #dc3545;
      color: #850009;
    }
  
    .animate-fade-in {
      animation: fadeIn 0.6s ease-out;
    }
  
    @media (max-width: 768px) {
      .arrow-button, .quiz-arrow-button {
        width: 36px;
        height: 36px;
        padding: 6px;
      }
      
      .arrow-button svg, .quiz-arrow-button svg {
        width: 32px;
        height: 32px;
      }
      
      .text-4xl {
        font-size: 2rem;
      }
      
      .text-2xl {
        font-size: 1.25rem;
      }
      
      .quiz-container {
        padding: 1rem;
        width: 90%;
      }
    }
  </style>
  
  <slot />
  