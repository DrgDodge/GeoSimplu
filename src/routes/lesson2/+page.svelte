<script>
  import "/src/app.css";

  export let title = "Hazarduri Naturale";

  export let sections = [
    {
      content: "DefiniÈ›ie: Hazardurile naturale sunt fenomene Ã®ntÃ¢mplÄƒtoare cu efecte negative asupra mediului È™i societÄƒÈ›ii. Acestea includ cutremure, erupÈ›ii vulcanice, inundaÈ›ii È™i alte evenimente geologice È™i meteorologice extreme.",
      imageUrl: "https://quizizz.com/media/resource/gs/quizizz-media/quizzes/71861667-27b0-42d9-80eb-17d72859163d",
      imageAlt: "IlustraÈ›ie hazarduri naturale"
    },
    {
      content: "Tectonica plÄƒcilor: Cutremurele È™i vulcanii sunt legate de miÈ™cÄƒrile plÄƒcilor tectonice. Zona Benioff (55-60Â° Ã®nclinare) este locul unde plÄƒcile se subduc, generÃ¢nd activitate seismicÄƒ intensÄƒ.",
      imageUrl: "https://thumbs.dreamstime.com/b/principal-tectonic-plates-map-289941533.jpg",
      imageAlt: "Harta plÄƒcilor tectonice"
    },
    {
      content: "Vulcanismul: ErupÈ›iile vulcanice (ex: Krakatoa 1883, St. Helens 1980) elibereazÄƒ lavÄƒ, gaze È™i cenuÈ™Äƒ. Efecte includ opacitatea atmosferei È™i distrugerea ecosistemelor. Vulcanii activi sunt cei cu erupÈ›ii Ã®n ultimele 2-3 generaÈ›ii.",
      imageUrl: "https://www.descopera.ro/wp-content/uploads/2016/02/15085849/2-vulcan-1.jpg",
      imageAlt: "ErupÈ›ie vulcanicÄƒ"
    },
    {
      content: "Cutremure: MÄƒsurate cu scÄƒrile Richter (magnitudine) È™i Mercalli (intensitate). Hipocentrul este focarul subteran, iar epicentrul punctul de la suprafaÈ›Äƒ deasupra acestuia. Zona Vrancea este cea mai activÄƒ din RomÃ¢nia.",
      imageUrl: "https://www.infp.ro/img/teorie/image12.png",
      imageAlt: "DiagramÄƒ cutremur"
    },
    {
      content: "AlunecÄƒri de teren: Cauzate de instabilitatea versanÈ›ilor. Tipuri: curgeri de noroi (Ã®n zone argiloase), prÄƒbuÈ™iri (zone cu roci dure). Pot bara rÃ¢uri È™i distruge infrastructura.",
      imageUrl: "https://forestdesign.ro/images/blog/alunecari5.jpg",
      imageAlt: "Alunecare de teren"
    },
    {
      content: "Fenomene climatice: Ciclonii tropicali (ex: uragane) se formeazÄƒ Ã®n zonele intertropicale. Tornadele sunt frecvente Ã®n zonele temperate. Impact major asupra zonelor de coastÄƒ È™i agriculturÄƒ.",
      imageUrl: "https://upload.wikimedia.org/wikipedia/commons/thumb/b/bc/Low_pressure_system_over_Iceland.jpg/1200px-Low_pressure_system_over_Iceland.jpg",
      imageAlt: "Ciclon tropical"
    },
    {
      content: "Riscuri hidrologice: InundaÈ›iile pe Gange-Brahmaputra, Mississippi È™i CÃ¢mpia Chinei. Cauze: precipitaÈ›ii excesive È™i topirea zÄƒpezilor.",
      imageUrl: "https://tb.ziareromania.ro/Inundatii-majore-in-Georgia---patru-morti/140471134f5b02e246/400/225/2/100/Inundatii-majore-in-Georgia---patru-morti.jpg",
      imageAlt: "InundaÈ›ii majore"
    },
    {
      content: "Dezertificare: Proces natural amplificat de agricultura nesustenabilÄƒ. Peste 40% din suprafaÈ›a terestrÄƒ este afectatÄƒ. Solul pierde fertilitatea datoritÄƒ aridizÄƒrii.",
      imageUrl: "https://upload.wikimedia.org/wikipedia/commons/thumb/9/94/ShrinkingLakeChad-1973-1997-EO.jpg/250px-ShrinkingLakeChad-1973-1997-EO.jpg",
      imageAlt: "Proces de dezertificare"
    },
    {
      content: "Prevenire: Sisteme de avertizare timpurie, construcÈ›ii antiseismice, management al pÄƒdurilor. EducaÈ›ia populaÈ›iei reduce riscurile.",
      imageUrl: "https://0.academia-photos.com/attachment_thumbnails/39009458/mini_magick20190223-27869-nic1yu.png?1550961482",
      imageAlt: "MÄƒsuri de prevenire"
    }
  ];

  let currentGroupIndex = 0;
  const itemsPerPage = 3;
  let direction = 'forward';
  let animateNext = false;
  let animatePrev = false;
  let showQuiz = false;
  let currentQuestionIndex = 0;
  let selectedAnswer = null;
  let score = 0;

  const quizQuestions = [
    {
      question: "Care este principala cauzÄƒ a cutremurelor?",
      options: [
        "ErupÈ›ii vulcanice",
        "MiÈ™cÄƒri ale plÄƒcilor tectonice",
        "SchimbÄƒri climatice",
        "ActivitÄƒÈ›i umane"
      ],
      correctAnswer: 1,
      explanation: "Cutremurele sunt cauzate de miÈ™cÄƒrile bruÈ™te ale plÄƒcilor tectonice, Ã®n special Ã®n zonele de subducÈ›ie."
    },
    {
      question: "Ce mÄƒsoarÄƒ scara Richter?",
      options: [
        "Intensitatea seismicÄƒ",
        "Magnitudinea energiei eliberate",
        "AdÃ¢ncimea hipocentrului",
        "Durata cutremurului"
      ],
      correctAnswer: 1,
      explanation: "Scara Richter mÄƒsoarÄƒ energia eliberatÄƒ de cutremur (magnitudine), Ã®n timp ce scara Mercalli evalueazÄƒ intensitatea perceputÄƒ."
    },
    {
      question: "Care fenomen NU este considerat hazard natural?",
      options: [
        "Tsunami",
        "ErupÈ›ie vulcanicÄƒ",
        "Poluare industrialÄƒ",
        "Ciclon tropical"
      ],
      correctAnswer: 2,
      explanation: "Poluarea industrialÄƒ este un hazard antropic, nu natural."
    },
    {
      question: "Unde se formeazÄƒ ciclonii tropicali?",
      options: [
        "La poli",
        "Ãn zonele temperate",
        "Ãn zona intertropicalÄƒ",
        "Ãn deÈ™erturi"
      ],
      correctAnswer: 2,
      explanation: "Ciclonii tropicali se formeazÄƒ Ã®n zona intertropicalÄƒ datoritÄƒ temperaturilor ridicate ale oceanului."
    },
    {
      question: "Ce procent din suprafaÈ›a terestrÄƒ este afectat de dezertificare?",
      options: ["10%", "25%", "40%", "60%"],
      correctAnswer: 2,
      explanation: "Peste 40% din suprafaÈ›a terestrÄƒ suferÄƒ de procese de aridizare È™i degradare a solului."
    },
    {
      question: "Care este zona seismicÄƒ cea mai activÄƒ din RomÃ¢nia?",
      options: [
        "MunÈ›ii Apuseni",
        "Depresiunea Transilvaniei",
        "Zona Vrancea",
        "Delta DunÄƒrii"
      ],
      correctAnswer: 2,
      explanation: "Zona Vrancea este cunoscutÄƒ pentru activitatea seismicÄƒ intensÄƒ datoritÄƒ subducÈ›iei plÄƒcii continentale."
    },
    {
      question: "Ce efect au erupÈ›iile vulcanice asupra atmosferei?",
      options: [
        "CreÈ™te nivelul oxigenului",
        "DiminueazÄƒ radiaÈ›iile solare",
        "Reduce poluarea",
        "CreÈ™te temperatura globalÄƒ"
      ],
      correctAnswer: 1,
      explanation: "CenuÈ™a È™i gazele vulcanice reduc transparenÈ›a atmosferei, blocÃ¢nd radiaÈ›iile solare."
    },
    {
      question: "Ce tip de alunecare de teren este specific zonelor argiloase?",
      options: [
        "PrÄƒbuÈ™iri",
        "Curgere de noroi",
        "AvalanÈ™e",
        "Eroziune"
      ],
      correctAnswer: 1,
      explanation: "Zonele cu substrat argilos sunt predispuse la curgeri de noroi datoritÄƒ comportamentului plastic al solului."
    }
  ];

  // FuncÈ›iile rÄƒmÃ¢n neschimbate
  function nextGroup() {
    direction = 'forward';
    if ((currentGroupIndex + 1) * itemsPerPage < sections.length) {
      currentGroupIndex++;
    }
  }

  function previousGroup() {
    direction = 'backward';
    if (currentGroupIndex > 0) {
      currentGroupIndex--;
    }
  }

  function handleNext() {
    animateNext = true;
    nextGroup();
  }

  function handlePrev() {
    animatePrev = true;
    previousGroup();
  }

  function startQuiz() {
    showQuiz = true;
  }

  function handleAnswer(index) {
    if (selectedAnswer !== null) return;
    selectedAnswer = index;
    if (index === quizQuestions[currentQuestionIndex].correctAnswer) score++;
  }

  function nextQuestion() {
    if (currentQuestionIndex < quizQuestions.length - 1) {
      currentQuestionIndex++;
      selectedAnswer = null;
    } else {
      currentQuestionIndex++;
    }
  }

  $: canGoBack = currentGroupIndex > 0;
  $: canGoNext = (currentGroupIndex + 1) * itemsPerPage < sections.length;
</script>

<!-- Structura HTML rÄƒmÃ¢ne identicÄƒ cu ajustÄƒri minore pentru conÈ›inut -->
<div class="p-5 -mt-20 fade-in">
  {#if !showQuiz}
    <p class="text-4xl font-bold text-white text-outline mb-8 text-center">
      {title}
    </p>

    {#key currentGroupIndex}
      <div>
        {#each sections.slice(currentGroupIndex * itemsPerPage, (currentGroupIndex + 1) * itemsPerPage) as section}
          <div class="flex flex-wrap justify-center items-center gap-8 lg:gap-12 mb-10">
            <div class="min-w-[300px] max-w-4xl flex-1">
              <p class="text-2xl text-white text-outline font-bold text-center lg:text-left">
                {section.content}
              </p>
            </div>
            <img 
              src={section.imageUrl} 
              alt={section.imageAlt} 
              class="h-60 lg:h-80 w-auto rounded-2xl border-4 border-[#125768] shrink-0 transition-all"
              loading="lazy"
            >
          </div>
        {/each}
      </div>
    {/key}

    <!-- Butoanele de navigaÈ›ie rÄƒmÃ¢n aceleaÈ™i -->
    {#if canGoBack}
      <button
        on:click={handlePrev}
        class="fixed left-8 top-1/2 -translate-y-1/2 bg-white/30 rounded-full p-2 hover:bg-white/50 transition-colors arrow-button"
        aria-label="SecÈ›iuni precedente"
      >
        <svg xmlns="http://www.w3.org/2000/svg" width="40" height="40" viewBox="0 0 24 24" fill="none" stroke="white" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
          <path d="M19 12H5M12 19l-7-7 7-7"/>
        </svg>
      </button>
    {/if}

    {#if canGoNext}
      <button
        on:click={handleNext}
        class="fixed right-8 top-1/2 -translate-y-1/2 bg-white/30 rounded-full p-2 hover:bg-white/50 transition-colors arrow-button"
        aria-label="SecÈ›iuni urmÄƒtoare"
      >
        <svg xmlns="http://www.w3.org/2000/svg" width="40" height="40" viewBox="0 0 24 24" fill="none" stroke="white" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
          <path d="M5 12h14M12 5l7 7-7 7"/>
        </svg>
      </button>
    {/if}

    {#if (currentGroupIndex + 1) * itemsPerPage >= sections.length && !showQuiz}
      <button
        on:click={startQuiz}
        class="fixed right-8 top-1/2 -translate-y-1/2 bg-white/30 rounded-full p-2 hover:bg-white/50 transition-colors quiz-arrow-button animate-arrow"
        aria-label="Ãncepe chestionarul"
      >
        <svg xmlns="http://www.w3.org/2000/svg" width="40" height="40" viewBox="0 0 24 24" fill="none" stroke="white" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
          <path d="M5 12h14M12 5l7 7-7 7"/>
        </svg>
      </button>
    {/if}
  {:else}
    <div class="quiz-container max-w-4xl mx-auto p-6">
      {#if currentQuestionIndex < quizQuestions.length}
        <div class="bg-white/30 backdrop-blur-lg rounded-2xl p-8 shadow-xl mb-8">
          <div class="text-white text-outline mb-6">
            <h3 class="text-2xl font-bold mb-2">Ãntrebarea {currentQuestionIndex + 1}/8</h3>
            <p class="text-xl leading-relaxed">{quizQuestions[currentQuestionIndex].question}</p>
          </div>

          <div class="grid gap-4 mb-8">
            {#each quizQuestions[currentQuestionIndex].options as option, index (index)}
              <button
                class="option-btn text-outline relative p-4 text-left rounded-xl transition-all"
                class:correct={selectedAnswer !== null && index === quizQuestions[currentQuestionIndex].correctAnswer}
                class:incorrect={selectedAnswer === index && index !== quizQuestions[currentQuestionIndex].correctAnswer}
                on:click={() => handleAnswer(index)}
                disabled={selectedAnswer !== null}
              >
                <span class="mr-4 font-bold">{String.fromCharCode(65 + index)}.</span>
                {option}
              </button>
            {/each}
          </div>

          {#if selectedAnswer !== null}
            <div class="pt-6 border-t-2 border-[#125768]/50">
              <div class:correct={selectedAnswer === quizQuestions[currentQuestionIndex].correctAnswer} class:incorrect={selectedAnswer !== quizQuestions[currentQuestionIndex].correctAnswer} class="feedback-message p-4 rounded-lg mb-6">
                {#if selectedAnswer === quizQuestions[currentQuestionIndex].correctAnswer}
                  âœ“ Corect! 
                {:else}
                  âœ— Incorect. 
                {/if}
                {quizQuestions[currentQuestionIndex].explanation}
              </div>

              <button 
                on:click={nextQuestion}
                class="next-question-btn w-full py-3 rounded-lg bg-[#125768] hover:bg-[#1a7f94] transition-colors text-white font-bold"
              >
                {currentQuestionIndex < quizQuestions.length - 1 ? 'UrmÄƒtoarea Ã®ntrebare â”' : 'Vezi rezultatul'}
              </button>
            </div>
          {/if}
        </div>
      {:else}
        <div class="text-center bg-white/30 backdrop-blur-md rounded-2xl p-12 shadow-xl animate-fade-in">
          <h2 class="text-3xl text-white text-outline font-bold mb-6">FelicitÄƒri! ğŸ‰</h2>
          <div class="text-5xl text-white text-outline font-bold mb-8">{score}/8</div>
          <p class="text-xl text-white text-outline mb-8">
            {#if score === 8}
              PerformanÈ›Äƒ remarcabilÄƒ! Ai o Ã®nÈ›elegere profundÄƒ a hazardurilor naturale!
            {:else if score >= 5}
              Rezultat foarte bun! CunoÈ™ti esenÈ›ialul despre riscurile naturale!
            {:else}
              Bun Ã®nceput! RecomandÄƒm recitirea materialului pentru consolidare.
            {/if}
          </p>
        </div>
      {/if}
    </div>
  {/if}
</div>

<!-- Stilurile CSS rÄƒmÃ¢n identice cu cele din exemplul anterior -->
<style>
  .fade-in {
    animation: fadeIn 0.5s ease-in;
  }
  
  @keyframes fadeIn {
    from { opacity: 0; transform: translateY(20px); }
    to { opacity: 1; transform: translateY(0); }
  }

  .text-outline {
    text-shadow: 
      -1px -1px 0 #000,  
      1px -1px 0 #000,
      -1px 1px 0 #000,
      1px 1px 0 #000;
  }

  .arrow-button, .quiz-arrow-button {
    filter: drop-shadow(0 2px 4px rgba(0, 0, 0, 0.3));
    backdrop-filter: blur(2px);
    transition: transform 0.2s ease-in-out, background-color 0.2s ease;
  }

  .arrow-button:hover, .quiz-arrow-button:hover {
    transform: translateY(-50%) scale(1.1);
    background-color: rgba(255, 255, 255, 0.5);
  }

  .animate-arrow {
    animation: arrowClickAnim 300ms ease-out;
  }

  @keyframes arrowClickAnim {
    0% { transform: scale(1); }
    50% { transform: scale(1.2); }
    100% { transform: scale(1); }
  }

  .option-btn {
    background: rgba(255, 255, 255, 0.1);
    border: 2px solid #125768;
    color: white;
    font-size: 1.1rem;
  }

  .option-btn:hover:not(:disabled) {
    background: rgba(255, 255, 255, 0.2);
    transform: translateY(-2px);
  }

  .option-btn.correct {
    background: rgba(40, 167, 69, 0.3);
    border-color: #28a745;
  }

  .option-btn.incorrect {
    background: rgba(220, 53, 69, 0.3);
    border-color: #dc3545;
  }

  .feedback-message {
    background: rgba(255, 255, 255, 0.15);
    border-left: 4px solid;
  }

  .feedback-message.correct {
    border-color: #005a15;
    color: #009e32;
  }

  .feedback-message.incorrect {
    border-color: #dc3545;
    color: #850009;
  }

  .animate-fade-in {
    animation: fadeIn 0.6s ease-out;
  }

  @media (max-width: 768px) {
    .arrow-button, .quiz-arrow-button {
      width: 36px;
      height: 36px;
      padding: 6px;
    }
    
    .arrow-button svg, .quiz-arrow-button svg {
      width: 32px;
      height: 32px;
    }
    
    .text-4xl {
      font-size: 2rem;
    }
    
    .text-2xl {
      font-size: 1.25rem;
    }
    
    .quiz-container {
      padding: 1rem;
      width: 90%;
    }
  }
</style>

<slot />